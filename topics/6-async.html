<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–≠—Ç–∞–ø 6: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        .order-status {
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #ccc;
        }
        .loading::after {
            content: ' ‚ñë‚ñë‚ñë';
            animation: loading 1s infinite;
        }
        @keyframes loading {
            0% { content: ' ‚ñë‚ñë‚ñë'; }
            33% { content: ' ‚ñà‚ñë‚ñë'; }
            66% { content: ' ‚ñà‚ñà‚ñë'; }
            100% { content: ' ‚ñà‚ñà‚ñà'; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>–≠—Ç–∞–ø 6: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</h1>
    <a href="../index.html">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ç–µ–º</a>

    <div class="content">
        <!-- –ê–Ω–∞–ª–æ–≥–∏—è -->
        <div class="analogy-section">
            <h2>üçî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äî –∫–∞–∫ –∑–∞–∫–∞–∑ –µ–¥—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</h2>
            <div class="delivery-flow">
                <div class="step">
                    <img src="https://cdn-icons-png.flaticon.com/512/857/857681.png" alt="–ó–∞–∫–∞–∑" width="80">
                    <p>1. –î–µ–ª–∞–µ–º –∑–∞–∫–∞–∑ (–∑–∞–ø—É—Å–∫–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é)</p>
                </div>
                <div class="step">
                    <img src="https://cdn-icons-png.flaticon.com/512/1830/1830839.png" alt="–û–∂–∏–¥–∞–Ω–∏–µ" width="80">
                    <p>2. –ó–∞–Ω–∏–º–∞–µ–º—Å—è –¥—Ä—É–≥–∏–º–∏ –¥–µ–ª–∞–º–∏ (–∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)</p>
                </div>
                <div class="step">
                    <img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" alt="–î–æ—Å—Ç–∞–≤–∫–∞" width="80">
                    <p>3. –ü–æ–ª—É—á–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (resolve/reject)</p>
                </div>
            </div>
        </div>

        <!-- Promise -->
        <div class="promise-section">
            <h3>üì¶ Promise ‚Äî –∫–≤–∏—Ç–∞–Ω—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
            <pre><code>function checkOrderStatus(orderId) {
  return new Promise((resolve, reject) => {
    // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
    setTimeout(() => {
      Math.random() > 0.1
        ? resolve('–î–æ—Å—Ç–∞–≤–ª–µ–Ω')
        : reject('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏');
    }, 2000);
  });
}</code></pre>
        </div>

        <!-- Async/await -->
        <div class="async-section">
            <h3>‚è≥ Async/await ‚Äî —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</h3>
            <pre><code>async function trackOrder() {
  try {
    const status = await checkOrderStatus('123');
    updateUI(status);
  } catch (error) {
    showError(error);
  }
}</code></pre>
        </div>

        <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ -->
        <div class="comparison">
            <h3>‚öñÔ∏è Promise.then vs Async/await</h3>
            <div class="methods">
                <div class="method">
                    <h4>–¶–µ–ø–æ—á–∫–∞ –ø—Ä–æ–º–∏—Å–æ–≤</h4>
                    <pre><code>getUser()
  .then(user => getOrders(user.id))
  .then(orders => render(orders))
  .catch(handleError);</code></pre>
                </div>
                <div class="method">
                    <h4>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å—Ç–∏–ª—å</h4>
                    <pre><code>try {
  const user = await getUser();
  const orders = await getOrders(user.id);
  render(orders);
} catch (err) {
  handleError(err);
}</code></pre>
                </div>
            </div>
            <p>‚úÖ –°–µ–≥–æ–¥–Ω—è —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç async/await –∑–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å</p>
        </div>

        <!-- –ü—Ä–∞–∫—Ç–∏–∫–∞ -->
        <div class="practice">
            <h2>üì¶ –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <div class="live-example">
                <button id="loadProducts">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
                <div id="productList" class="order-status">–°—Ç–∞—Ç—É—Å: –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
            </div>

            <pre><code>async function loadProducts() {
  try {
    const response = await fetch('/api/products');
    const products = await response.json();
    renderProducts(products);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
  }
}</code></pre>
        </div>
        <!-- –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª content –ø–µ—Ä–µ–¥ —á–µ–∫–ª–∏—Å—Ç–æ–º -->

        <div class="tasks">
            <h2>üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>

            <div class="task">
                <h4>–ó–∞–¥–∞—á–∞ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–µ</h4>
                <p>1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é <code>loadProduct</code>, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫.</p>
                <p>2. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å "–¢–æ–≤–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω"</p>
                <button class="show-solution">–†–µ—à–µ–Ω–∏–µ</button>
                <pre class="solution"><code>async function loadProduct() {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve({ id: 1, name: 'Phone', price: 999 });
    }, 1000);
  });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
loadProduct().then(product => console.log('–¢–æ–≤–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω:', product));</code></pre>
            </div>

            <div class="task">
                <h4>–ó–∞–¥–∞—á–∞ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</h4>
                <p>–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–∫–∞–∑–∞, —á—Ç–æ–±—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å alert</p>
                <pre class="problem-code"><code>async function createOrder() {
  const response = await fetch('/api/orders');
  return response.json();
}</code></pre>
                <button class="show-solution">–†–µ—à–µ–Ω–∏–µ</button>
                <pre class="solution"><code>async function createOrder() {
  try {
    const response = await fetch('/api/orders');
    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ HTTP: ' + response.status);
    return await response.json();
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –∑–∞–∫–∞–∑–∞: ' + error.message);
    throw error;
  }
}</code></pre>
            </div>

            <div class="task">
                <h4>–ó–∞–¥–∞—á–∞ 3: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h4>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:</p>
                <ul>
                    <li>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</li>
                    <li>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                    <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</li>
                </ul>
                <button class="show-solution">–†–µ—à–µ–Ω–∏–µ</button>
                <pre class="solution"><code>async function loadAllData() {
  const [products, user, settings] = await Promise.all([
    fetch('/api/products'),
    fetch('/api/user'),
    fetch('/api/settings')
  ]);

  return {
    products: await products.json(),
    user: await user.json(),
    settings: await settings.json()
  };
}</code></pre>
            </div>

            <div class="task">
                <h4>–ó–∞–¥–∞—á–∞ 4: –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞</h4>
                <p>–°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ API, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥</p>
                <button class="show-solution">–†–µ—à–µ–Ω–∏–µ</button>
                <pre class="solution"><code>async function fetchWithTimeout(url, timeout = 5000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);

  try {
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeoutId);
    return response.json();
  } catch (error) {
    if (error.name === 'AbortError') {
      throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è');
    }
    throw error;
  }
}</code></pre>
            </div>

            <div class="task">
                <h4>–ó–∞–¥–∞—á–∞ 5: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞</h4>
                <p>–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞</p>
                <button class="show-solution">–†–µ—à–µ–Ω–∏–µ</button>
                <pre class="solution"><code>async function fetchWithRetry(url, retries = 3) {
  for (let i = 0; i < retries; i++) {
    try {
      const response = await fetch(url);
      return await response.json();
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
}</code></pre>
            </div>
        </div>

        <!-- –ß–µ–∫–ª–∏—Å—Ç -->
        <div class="checklist">
            <h3>‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫</h3>
            <ul>
                <li><input type="checkbox"> –ü–æ–Ω–∏–º–∞—é event loop</li>
                <li><input type="checkbox"> –ú–æ–≥—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å Promise –≤ async/await</li>
                <li><input type="checkbox"> –ó–Ω–∞—é –ø—Ä–æ Promise.all –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</li>
                <li><input type="checkbox"> –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –æ—à–∏–±–∫–∏ try/catch</li>
            </ul>
        </div>

        <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã -->
        <div class="pro-tips">
            <h3>üí° –°–æ–≤–µ—Ç—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏</h3>
            <div class="tip">
                <div class="icon">üöÄ</div>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Promise.all –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:</p>
                <pre><code>const [user, products] = await Promise.all([
  fetchUser(),
  fetchProducts()
]);</code></pre>
            </div>
        </div>
    </div>
</div>
<script>
    // –î–µ–º–æ-–∫–æ–¥ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    const statusElement = document.getElementById('productList');

    document.getElementById('loadProducts').addEventListener('click', async () => {
        statusElement.className = 'order-status loading';
        statusElement.textContent = '–°—Ç–∞—Ç—É—Å: –ó–∞–≥—Ä—É–∑–∫–∞';

        try {
            // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API
            await new Promise(resolve => setTimeout(resolve, 1500));
            statusElement.className = 'order-status';
            statusElement.textContent = '–°—Ç–∞—Ç—É—Å: –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ 15 —Ç–æ–≤–∞—Ä–æ–≤';
        } catch (error) {
            statusElement.className = 'order-status';
            statusElement.textContent = '–°—Ç–∞—Ç—É—Å: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        }
    });
</script>
</body>
</html>
